
<!DOCTYPE html>
<html>
<head>
    <style>
        
    </style>
    </head>
<body>
    <body>
    <canvas id="myCanvas" width="2000" height="1000"></canvas>
</body>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script type="text/javascript">
    
function getSquare(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
        x: 1 + (evt.clientX - rect.left) - (evt.clientX - rect.left)%200,
        y: 1 + (evt.clientY - rect.top) - (evt.clientY - rect.top)%200
    };
}

var usernum = -1;

var locations = [
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99],
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99],
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99],
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99],
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99]
];

var locations4 = [
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99],
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99],
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99],
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99],
    [-1, -1, -1, -1, -1, 99, 99, 99, 99, 99],
    [-51, -51, -51, -51, -51, 49, 49, 49, 49, 49],
    [-51, -51, -51, -51, -51, 49, 49, 49, 49, 49],
    [-51, -51, -51, -51, -51, 49, 49, 49, 49, 49],
    [-51, -51, -51, -51, -51, 49, 49, 49, 49, 49],
    [-51, -51, -51, -51, -51, 49, 49, 49, 49, 49]
];

var blocksPlaced1 = 0;
var blocksPlaced2 = 0;
var maxBlocks = 6;
var playerTurn = 0;
var ended = 0;
var placed = 0;
try{
    var socket = io();
}catch(e){
    window.alert('no socket');
}


function drawGrid(context) {
    for (var x = 0.5; x < 2880; x += 200) {
      context.moveTo(x, 0);
      context.lineTo(x, 10000);
    }
    
    for (var y = 0.5; y < 1441; y += 200) {
      context.moveTo(0, y);
      context.lineTo(10000, y);
    }
    
    context.strokeStyle = "#ddd";
    context.stroke();
}

function setSquare(context, x, y){
    var xfloor = Math.floor(x / 200);
    var yfloor = Math.floor(y / 200);

    if (playerTurn == 0) {
        if (xfloor < 5) {
            if (locations[yfloor][xfloor] == 0) {
                locations[yfloor][xfloor] = 1;
                context.fillStyle = "#FFFF33";
                context.fillRect(x,y,199,199);
                console.log(blocksPlaced2);
                blocksPlaced2--;
            } else {
                context.fillStyle = "#FFFFFF";
                context.fillRect(x,y,199,199);
            }
            playerTurn = 1;
        } else {
            console.log("you are handicapped");
        }
    } else if (playerTurn == 1) {
        if (xfloor > 4) {
            if (locations[yfloor][xfloor] == 100) {
                locations[yfloor][xfloor] = 101;
                context.fillStyle = "#FFFF33";
                context.fillRect(x, y, 199, 199);
                console.log(blocksPlaced1);
                blocksPlaced1--;
            } else {
                context.fillStyle = "#000000";
                context.fillRect(x,y,199,199);
            }
            playerTurn = 0;
        } else {
            console.log("you are handicapped");
        }
    } else {
        console.log("the fuck");
    }

    var k = 0;
    var i = 0;

    if (blocksPlaced2 === 0) {
        for (k = 0; k < 10; k++) {
            for (i = 0; i < 5; i++) {
                context.fillStyle = "#FF66FF";
                context.fillRect(200*k + 1, 200*i + 1, 199, 199);
                socket.emit('ended', 'ended');
                ended = 1;
            }
        }
    } else if (blocksPlaced1 === 0) {
        for (k = 0; k < 10; k++) {
            for (i = 0; i < 5; i++) {
                context.fillStyle = "#4C0099";
                context.fillRect(200*k + 1, 200*i + 1, 199, 199);
                ended = 1;
            }
        }
    }
}

function placeShips(context, x, y) {
    var xfloor = Math.floor(x / 200);
    var yfloor = Math.floor(y / 200);
    if (blocksPlaced1 < 6) {
        if (xfloor > 4) {
            if (locations[yfloor][xfloor] == 100) {
                return;
            }
            locations[yfloor][xfloor] = 100;
            context.fillStyle = "#66CC00";
            if ((usernum % 2) == 1) {
                context.fillRect(x,y,199,199);
            }
            blocksPlaced1++;
        } else {
            // do nothing
        }
    } else {
        if (xfloor < 5) {
            if (locations[yfloor][xfloor] == 0) {
                return;
            }
            locations[yfloor][xfloor] = 0;
            context.fillStyle = "#CC0066";
            if ((usernum % 2) == 0) {
                context.fillRect(x,y,199,199);
            }
            blocksPlaced2++;
        } else {
            // do nothing
        }
        if (blocksPlaced2 == 6) {
            placed = 1;
        }
    }
}

function initialFill(context) {
    var j;
    var k;
    for (j = 0; j < 10; j++) {
        context.fillStyle = "#0066CC";
        if (j > 4) {
            context.fillStyle = "#3399FF";
        }
        for (k = 0; k < 5; k++) {
            context.fillRect(200*j + 1, 200*k + 1, 199, 199);
        }
    }
}

function testFill(context) {
    var j;
    var k;
    for (j = 0; j < 10; j++) {
        context.fillStyle = "#000000";
        if (j > 4) {
            context.fillStyle = "#000000";
        }
        for (k = 0; k < 5; k++) {
            context.fillRect(200*j + 1, 200*k + 1, 199, 199);
        }
    }
}

var canvas = document.getElementById('myCanvas');
var context = canvas.getContext('2d');


drawGrid(context);

initialFill(context);
//var socket = io();

$(function() {
//    var socket = io();
    canvas.addEventListener('click', function(e) {
        e.preventDefault();
        var mousePos = getSquare(canvas, e);
        socket.emit('clicked', mousePos);
        return false;
    });
    socket.on('clicked', function(msg) {
        console.log(msg);
        if (ended == 0) {
            if (((blocksPlaced1 != 6) || (blocksPlaced2 != 6)) && (placed == 0)) {
                placeShips(context, msg.x, msg.y);
            } else {
                setSquare(context, msg.x, msg.y)
            }
        }
    });
    socket.on('setusernum', function(msg) {
        console.log('settingusernum');
        console.log(msg);
        if (usernum === -1) {
            usernum = msg;  
        }
    })
});

/**canvas.addEventListener('click', function(evt) {
    var mousePos = getSquare(canvas, evt);

    if (ended == 0) {
        if (((blocksPlaced1 != 6) || (blocksPlaced2 != 6)) && (placed == 0)) {
            placeShips(context, mousePos.x, mousePos.y);
        } else {
            setSquare(context, mousePos.x, mousePos.y)
        }
    }
    
    
    //document.write(x);
    //document.write(y);
}, false);**/
    </script>
</body>
</html>